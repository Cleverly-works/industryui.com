{"version":3,"sources":["../../../components/molecules/preview/index.js"],"names":["React","memo","useEffect","useState","useRef","styled","css","Cropper","imageFormats","isImage","src","isIt","format","includes","fileType","source","toLowerCase","undefined","checkFileType","file","type","URL","createObjectURL","Preview","contain","dim","imageStyles","onClick","onPdfDocumentLoaded","placeHolderImageUrl","showName","showPagesNumber","small","message","zoomable","Document","Page","pdfjs","pdfLoader","setPdfLoader","loadModules","path","GlobalWorkerOptions","workerSrc","version","cropperRef","onDocumentLoadSuccess","numPages","name","pagesNumber","imagePreview","height","width","pdfPreview","thumbnail","prevFile","nextFile","PreviewImage","img","PdfWrapper","div","size","FilePlaceHolder","PlaceHolder"],"mappings":"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","sourcesContent":["/**\n * Preview\n */\n\n// React\nimport React, { memo, useEffect, useState, useRef } from 'react'\n\n// UI\nimport styled, { css } from 'styled-components'\nimport Cropper from 'react-cropper'\n\nconst imageFormats = ['.jpg', '.jpeg', '.png']\n\nconst isImage = (src) => {\n  let isIt = false\n\n  for (const format of imageFormats) {\n    if (src.includes(format)) {\n      isIt = true\n      break\n    }\n  }\n\n  return isIt\n}\n\nconst fileType = (source) => {\n  if (source) {\n    const src = source.toLowerCase()\n\n    if (isImage(src)) {\n      return 'image'\n    } else if (src.includes('.pdf')) {\n      return 'pdf'\n    } else {\n      return undefined\n    }\n  } else {\n    return undefined\n  }\n}\n\nconst checkFileType = (file, type) => {\n  if (file?.type.includes(type) || fileType(file?.src) === type) {\n    return true\n  }\n\n  return false\n}\n\nconst source = (file) => {\n  return file.src ?? URL.createObjectURL(file)\n}\n\nexport const Preview = memo(\n  ({\n    contain,\n    dim,\n    file,\n    imageStyles,\n    onClick,\n    onPdfDocumentLoaded,\n    placeHolderImageUrl,\n    showName,\n    showPagesNumber,\n    small,\n    message,\n    zoomable\n  }) => {\n    const [pdfLoader, setPdfLoader] = useState({\n      Document: null,\n      Page: null,\n      pdfjs: null\n    })\n\n    const loadModules = async () => {\n      const { Document, Page, pdfjs } = await import('react-pdf')\n      const path = '//cdnjs.cloudflare.com/ajax/libs/pdf.js'\n      pdfjs.GlobalWorkerOptions.workerSrc = `${path}/${pdfjs.version}/pdf.worker.js`\n      setPdfLoader({ Document, Page, pdfjs })\n    }\n\n    useEffect(() => {\n      loadModules()\n      return () => {}\n    }, [])\n\n    const cropperRef = useRef(null)\n\n    const onDocumentLoadSuccess = ({ numPages }) => {\n      showPagesNumber &&\n        onPdfDocumentLoaded &&\n        onPdfDocumentLoaded({\n          file,\n          name: file?.name,\n          pagesNumber: numPages\n        })\n    }\n\n    const src = source(file)\n\n    const imagePreview = () => {\n      if (zoomable) {\n        return (\n          <Cropper\n            src={file.src ?? URL.createObjectURL(file)}\n            style={{ height: '100%', width: '100%' }}\n            highlight\n            movable\n            zoomable\n            zoomOnTouch\n            zoomOnWheel\n            autoCrop={false}\n            background={false}\n            guides={false}\n            checkCrossOrigin={false}\n            dragMode=\"move\"\n            ref={cropperRef}\n          />\n        )\n      } else {\n        return (\n          <PreviewImage\n            contain={contain}\n            dim={dim}\n            src={src}\n            onClick={onClick}\n            style={imageStyles}\n          />\n        )\n      }\n    }\n\n    const pdfPreview = () => {\n      if (file.thumbnail) {\n        return (\n          <PreviewImage\n            contain={contain}\n            dim={dim}\n            src={file.thumbnail}\n            onClick={onClick}\n            style={imageStyles}\n          />\n        )\n      } else {\n        return (\n          <PdfWrapper onClick={onClick} small={small} message={message}>\n            {pdfLoader.Document && (\n              <>\n                <pdfLoader.Document\n                  file={src}\n                  onLoadSuccess={onDocumentLoadSuccess}>\n                  <pdfLoader.Page pageNumber={1} />\n                </pdfLoader.Document>\n              </>\n            )}\n          </PdfWrapper>\n        )\n      }\n    }\n\n    if (checkFileType(file, 'image')) {\n      return imagePreview()\n    } else if (checkFileType(file, 'pdf')) {\n      return pdfPreview()\n    } else {\n      return (\n        <PlaceHolder>\n          <FilePlaceHolder placeHolderImageUrl={placeHolderImageUrl} />\n          {showName && file?.name}\n        </PlaceHolder>\n      )\n    }\n  },\n  ({ file: prevFile }, { file: nextFile }) => {\n    if (nextFile.src) {\n      if (!(prevFile.src === nextFile.src)) {\n        return false\n      }\n    } else if (nextFile.name) {\n      if (!(prevFile.name === nextFile.name)) {\n        return false\n      }\n    }\n    return true\n  }\n)\n\nconst PreviewImage = styled.img`\n  width: 100%;\n  ${({ onClick }) =>\n    onClick &&\n    css`\n      cursor: pointer;\n    `}\n  ${({ contain }) =>\n    contain &&\n    css`\n      object-fit: contain;\n    `}\n  ${({ dim }) =>\n    dim &&\n    css`\n      filter: brightness(0.4);\n    `}\n`\n\nconst PdfWrapper = styled.div`\n  ${({ onClick }) =>\n    onClick &&\n    css`\n      cursor: pointer;\n    `}\n  ${({ small, message }) => {\n    if (message || small) {\n      const size = small ? '4rem' : '10rem'\n      return css`\n        width: 100%;\n        height: ${size};\n        overflow: hidden;\n        .react-pdf__Page__canvas,\n        .react-pdf__Page__textContent {\n          width: 100% !important;\n          height: auto !important;\n        }\n      `\n    }\n  }}\n`\n\nconst FilePlaceHolder = styled.div`\n  background-image: url(${({ placeHolderImageUrl }) =>\n    placeHolderImageUrl ??\n    'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAA8CAYAAADL94L/AAAByElEQVR4Ae3axdJTQRAFYFyegA3u8ALseCDcicsGhxt3x+G32BXc3X3NBnfXYTqp3sZlhuqpOlXZRL46He9ReJyJxGSTEreaPfEHZiX+1uSJvelVNu+Jvjd7Yk9zI8aSUe0eDpjCIYfNSuw5v/zF5In/6mU27478tXriLJvXjdSwPq1lCDTCmxjiCNav8GZYBVMwWKagX8kWjk9vCcMhYWhEFEw1+oV0wZjdPKY6Vn9EwmBDTYPwBoXCYPLGDQTJjkHQNQRJj0FQtmgs+C8wOHIIkh2DoDu5vD5Xfkz9hsTBWDyxhjDYUDqvLRYSY1JilSQGyyxXOt4QKJPX70NDQmI27gyxHcn9bH/5RFMNAUgoDI4afOAMHBiCdiDNj5woGAhgsCEYudSI1lBCRwoPL957slAoDDYEoPXb/ZVs3FE/y9072fDxsx4BMPVfGOpl1VY/y5++4EWM1Fm9LcCKpy8RpnchDGEIQxjCEIYwhCEMYQhDGMIQhjCEIQxhCEMYwhCGMIQhDGEIQxhYNlXiP+XHXLRDM5thQVpyzIfS2YtLceVEkRmzalsgMArPhp258bA6b/LEb8LqPM930VNdvY/fhMmCxw+Of+4BTcPInBo2AAAAAElFTkSuQmCC'});\n  background-repeat: no-repeat;\n  background-size: contain;\n  height: 3rem;\n  margin-bottom: 0.5rem;\n  width: 3rem;\n`\n\nconst PlaceHolder = styled.div`\n  align-items: center;\n  display: flex;\n  flex-direction: column;\n`\n"],"file":"index.js"}