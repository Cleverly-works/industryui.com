{"version":3,"sources":["../../../../../../components/organisms/messaging/components/base/components/base.js"],"names":["React","useRef","useState","any","string","Avatar","AudioWrapper","Card","Column","Dropdown","hashtagPlugin","Icon","Image","linkifyPlugin","MentionComponent","MessageNames","MessagingActions","MessagingAudioPlayer","MessagingCommunicationService","MessagingEditor","Preview","ReplyContainer","Row","TranslationService","MessageIcon","MessageTo","MenuIcon","Loadingspinner","EditorState","ContentState","convertFromRaw","createMentionPlugin","createEmojiPlugin","styled","css","mentionPlugin","mentionComponent","mentionProps","emojiPlugin","MessageBase","attachments","avatar","content","from","hasMenu","hasText","hovered","icon","id","more","pictureId","prevType","reply","replyTo","statusText","time","to","type","voice","createWithContent","blocks","createFromText","editorState","setEditorState","showingTranslation","setShowingTranslation","loadingTranslation","setloadingTranslation","translated","toggleTranslation","current","plainText","map","block","text","trim","join","Translate","response","dropDownAction","item","action","EDIT_MESSAGE","DELETE_MESSAGE","STAR_MESSAGE","send","name","Messaging","MESSAGING_ACTION","payload","data","handleFileClick","files","index","av","SET_FULL_PREVIEW_FILES","selectedIndex","split","length","display","alignItems","marginTop","e","Array","forEach","minHeight","height","objectFit","OverlayForAdditionalMessages","div","StyledHeadText","TranslatorWrapper","MESSAGING","theme","translatorTextColour","MenuWrapper","SingleAttachment","AttachmentsContainer","MessageWrapper","StyledCard","receivedMessageBackground","sentMessageBackground","messageBorderColour","StyledContent","messageContentColour","messageFontSize","StyledReply","messageReplyTextColour","StyledHead","span","fromTextColour","Dot","propTypes"],"mappings":";;;;;;;AAAA;AACA;AACA;AAEA;AACA,OAAOA,KAAP,IAAgBC,MAAhB,EAAwBC,QAAxB,QAAwC,OAAxC;AACA,SAASC,GAAT,EAAcC,MAAd,QAA4B,YAA5B,C,CAEA;;AACA,SACEC,MADF,EAEEC,YAFF,EAGEC,IAHF,EAIEC,MAJF,EAKEC,QALF,EAMEC,aANF,EAOEC,IAPF,EAQEC,KARF,EASEC,aATF,EAUEC,gBAVF,EAWEC,YAXF,EAYEC,gBAZF,EAaEC,oBAbF,EAcEC,6BAdF,EAeEC,eAfF,EAgBEC,OAhBF,EAiBEC,cAjBF,EAkBEC,GAlBF,EAmBEC,kBAnBF,QAoBO,iBApBP;AAsBA,SAASC,WAAT,QAA4B,QAA5B;AACA,SAASC,SAAT,QAA0B,MAA1B;AACA,SAASC,QAAT,QAAyB,YAAzB;AACA,SAASC,cAAT,QAA+B,kBAA/B;AACA,SAASC,WAAT,EAAsBC,YAAtB,EAAoCC,cAApC,QAA0D,UAA1D;AACA,OAAOC,mBAAP,MAAgC,2BAAhC;AACA,OAAOC,iBAAP,MAA8B,yBAA9B,C,CAEA;;AACA,OAAOC,MAAP,IAAiBC,GAAjB,QAA4B,mBAA5B;AAEA,IAAMC,aAAa,GAAGJ,mBAAmB,CAAC;AACxCK,EAAAA,gBAAgB,EAAE,0BAACC,YAAD;AAAA,wBAChB,oBAAC,gBAAD;AAAkB,MAAA,YAAY,EAAEA;AAAhC,MADgB;AAAA;AADsB,CAAD,CAAzC;AAMA,IAAMC,WAAW,GAAGN,iBAAiB,EAArC;AAEA,OAAO,IAAMO,WAAW,GAAG,SAAdA,WAAc,OAoBrB;AAAA,MAnBJC,WAmBI,QAnBJA,WAmBI;AAAA,MAlBJC,MAkBI,QAlBJA,MAkBI;AAAA,MAjBJC,OAiBI,QAjBJA,OAiBI;AAAA,MAhBJC,IAgBI,QAhBJA,IAgBI;AAAA,MAfJC,OAeI,QAfJA,OAeI;AAAA,MAdJC,OAcI,QAdJA,OAcI;AAAA,MAbJC,OAaI,QAbJA,OAaI;AAAA,MAZJC,IAYI,QAZJA,IAYI;AAAA,MAXJC,EAWI,QAXJA,EAWI;AAAA,MAVJC,IAUI,QAVJA,IAUI;AAAA,MATJC,SASI,QATJA,SASI;AAAA,MARJC,QAQI,QARJA,QAQI;AAAA,MAPJC,KAOI,QAPJA,KAOI;AAAA,MANJC,OAMI,QANJA,OAMI;AAAA,MALJC,UAKI,QALJA,UAKI;AAAA,MAJJC,IAII,QAJJA,IAII;AAAA,MAHJC,EAGI,QAHJA,EAGI;AAAA,MAFJC,IAEI,QAFJA,IAEI;AAAA,MADJC,KACI,QADJA,KACI;;AAAA,kBACkCxD,QAAQ,CAC5C0B,WAAW,CAAC+B,iBAAZ,CACEjB,OAAO,CAACkB,MAAR,GACI9B,cAAc,CAACY,OAAD,CADlB,GAEIb,YAAY,CAACgC,cAAb,CAA4BnB,OAA5B,CAHN,CAD4C,CAD1C;AAAA;AAAA,MACGoB,WADH;AAAA,MACgBC,cADhB;;AAAA,mBASgD7D,QAAQ,CAAC,KAAD,CATxD;AAAA;AAAA,MASG8D,kBATH;AAAA,MASuBC,qBATvB;;AAAA,mBAUgD/D,QAAQ,CAAC,KAAD,CAVxD;AAAA;AAAA,MAUGgE,kBAVH;AAAA,MAUuBC,qBAVvB;;AAWJ,MAAMC,UAAU,GAAGnE,MAAM,CAAC,IAAD,CAAzB;;AAEA,MAAMoE,iBAAiB;AAAA,yEAAG;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,kBACnBL,kBADmB;AAAA;AAAA;AAAA;;AAAA,kBAEjBI,UAAU,CAACE,OAFM;AAAA;AAAA;AAAA;;AAGpBH,cAAAA,qBAAqB,CAAC,IAAD,CAArB;;AAEA,kBAAIzB,OAAO,CAACkB,MAAZ,EAAoB;AAClBW,gBAAAA,SAAS,GAAG7B,OAAO,CAACkB,MAAR,CACTY,GADS,CACL,UAACC,KAAD;AAAA,yBAAY,CAACA,KAAK,CAACC,IAAN,CAAWC,IAAX,EAAD,IAAsB,IAAvB,IAAgCF,KAAK,CAACC,IAAjD;AAAA,iBADK,EAETE,IAFS,CAEJ,IAFI,CAAZ;AAGD,eAJD,MAIO;AACLL,gBAAAA,SAAS,GAAG7B,OAAZ;AACD;;AAXmB;AAAA,qBAYOnB,kBAAkB,CAACsD,SAAnB,CAA6BN,SAA7B,CAZP;;AAAA;AAAA;AAYZO,cAAAA,QAZY,yBAYZA,QAZY;AAapBV,cAAAA,UAAU,CAACE,OAAX,GAAqB1C,WAAW,CAAC+B,iBAAZ,CACnB9B,YAAY,CAACgC,cAAb,CAA4BiB,QAA5B,CADmB,CAArB;AAGAf,cAAAA,cAAc,CAACK,UAAU,CAACE,OAAZ,CAAd;AACAL,cAAAA,qBAAqB,CAAC,IAAD,CAArB;AACAE,cAAAA,qBAAqB,CAAC,KAAD,CAArB;AAlBoB;AAAA;;AAAA;AAoBpBJ,cAAAA,cAAc,CAACK,UAAU,CAACE,OAAZ,CAAd;AACAL,cAAAA,qBAAqB,CAAC,IAAD,CAArB;;AArBoB;AAAA;AAAA;;AAAA;AAwBtBF,cAAAA,cAAc,CACZnC,WAAW,CAAC+B,iBAAZ,CACEjB,OAAO,CAACkB,MAAR,GACI9B,cAAc,CAACY,OAAD,CADlB,GAEIb,YAAY,CAACgC,cAAb,CAA4BnB,OAA5B,CAHN,CADY,CAAd;AAOAuB,cAAAA,qBAAqB,CAAC,KAAD,CAArB;;AA/BsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAjBI,iBAAiB;AAAA;AAAA;AAAA,KAAvB;;AAkCA,MAAMU,cAAc,GAAG,SAAjBA,cAAiB,CAACC,IAAD,EAAU;AAC/B,QAAIC,MAAM,GAAG,EAAb;;AACA,YAAQD,IAAI,CAAChC,EAAb;AACE,WAAK,MAAL;AACEiC,QAAAA,MAAM,GAAGjE,gBAAgB,CAACkE,YAA1B;AACA;;AACF,WAAK,QAAL;AACED,QAAAA,MAAM,GAAGjE,gBAAgB,CAACmE,cAA1B;AACA;;AACF,WAAK,MAAL;AACEF,QAAAA,MAAM,GAAGjE,gBAAgB,CAACoE,YAA1B;AACA;;AAEF;AACE;AAZJ;;AAcAlE,IAAAA,6BAA6B,CAACmE,IAA9B,CAAmC;AACjCC,MAAAA,IAAI,EAAEvE,YAAY,CAACwE,SAAb,CAAuBC,gBADI;AAEjCC,MAAAA,OAAO,EAAE;AACPR,QAAAA,MAAM,EAANA,MADO;AAEPS,QAAAA,IAAI,EAAE;AACJlD,UAAAA,WAAW,EAAXA,WADI;AAEJE,UAAAA,OAAO,EAAPA,OAFI;AAGJC,UAAAA,IAAI,EAAJA,IAHI;AAIJG,UAAAA,OAAO,EAAPA,OAJI;AAKJC,UAAAA,IAAI,EAAJA,IALI;AAMJC,UAAAA,EAAE,EAAFA,EANI;AAOJC,UAAAA,IAAI,EAAJA,IAPI;AAQJC,UAAAA,SAAS,EAATA,SARI;AASJC,UAAAA,QAAQ,EAARA,QATI;AAUJC,UAAAA,KAAK,EAALA,KAVI;AAWJE,UAAAA,UAAU,EAAVA,UAXI;AAYJC,UAAAA,IAAI,EAAJA,IAZI;AAaJC,UAAAA,EAAE,EAAFA,EAbI;AAcJC,UAAAA,IAAI,EAAJA,IAdI;AAeJC,UAAAA,KAAK,EAALA;AAfI;AAFC;AAFwB,KAAnC;AAuBD,GAvCD;;AAyCA,MAAMiC,eAAe,GAAG,SAAlBA,eAAkB,CAACC,KAAD,EAAQC,KAAR,EAAkB;AACxC,QAAMC,EAAE,GAAGrD,MAAM,gBACf,oBAAC,MAAD;AAAQ,MAAA,IAAI,EAAC,KAAb;AAAmB,MAAA,GAAG,EAAEA;AAAxB,MADe,gBAGf,oBAAC,MAAD;AAAQ,MAAA,IAAI,EAAC,KAAb;AAAmB,MAAA,OAAO,EAAEE,IAAI,CAAC,CAAD;AAAhC,MAHF;AAMAzB,IAAAA,6BAA6B,CAACmE,IAA9B,CAAmC;AACjCC,MAAAA,IAAI,EAAEvE,YAAY,CAACwE,SAAb,CAAuBC,gBADI;AAEjCC,MAAAA,OAAO,EAAE;AACPR,QAAAA,MAAM,EAAEjE,gBAAgB,CAAC+E,sBADlB;AAEPL,QAAAA,IAAI,EAAE;AACJE,UAAAA,KAAK,EAALA,KADI;AAEJI,UAAAA,aAAa,EAAEH,KAFX;AAGJpD,UAAAA,MAAM,EAAEqD,EAHJ;AAIJnD,UAAAA,IAAI,EAAJA,IAJI;AAKJY,UAAAA,IAAI,EAAJA;AALI;AAFC;AAFwB,KAAnC;AAaD,GApBD;;AAsBA,sBACE,oBAAC,cAAD;AAAgB,IAAA,IAAI,EAAEE,IAAtB;AAA4B,IAAA,OAAO,EAAEX;AAArC,kBACE,oBAAC,UAAD;AAAY,IAAA,IAAI,EAAEW;AAAlB,kBACE,oBAAC,cAAD;AAAgB,IAAA,IAAI,EAAEA;AAAtB,KACGd,IADH,oBACS,oBAAC,GAAD,OADT,EAEGY,IAAI,CAAC0C,KAAL,CAAW,GAAX,EAAgB1C,IAAI,CAAC0C,KAAL,CAAW,GAAX,EAAgBC,MAAhB,GAAyB,CAAzC,CAFH,CADF,EAMGtD,OAAO,iBACN,oBAAC,WAAD,qBACE,oBAAC,QAAD;AACE,IAAA,KAAK,EAAE,KADT;AAEE,IAAA,KAAK,EAAE,CACL;AAAE0C,MAAAA,IAAI,EAAE,cAAR;AAAwBtC,MAAAA,EAAE,EAAE;AAA5B,KADK,EAEL;AAAEsC,MAAAA,IAAI,EAAE,cAAR;AAAwBtC,MAAAA,EAAE,EAAE;AAA5B,KAFK,EAGL;AAAEsC,MAAAA,IAAI,EAAE,gBAAR;AAA0BtC,MAAAA,EAAE,EAAE;AAA9B,KAHK,CAFT;AAOE,IAAA,QAAQ,EAAC,QAPX;AAQE,IAAA,QAAQ,EAAE,kBAACgC,IAAD;AAAA,aAAUD,cAAc,CAACC,IAAD,CAAxB;AAAA;AARZ,kBASE,oBAAC,QAAD,OATF,CADF,CAPJ,CADF,eAwBE,oBAAC,UAAD;AAAY,IAAA,IAAI,EAAEvB;AAAlB,kBACE,oBAAC,GAAD,qBACE,oBAAC,MAAD;AACE,IAAA,EAAE,EAAE,CADN;AAEE,IAAA,KAAK,EAAE;AACL0C,MAAAA,OAAO,EAAE,MADJ;AAELC,MAAAA,UAAU,EAAE,QAFP;AAGLC,MAAAA,SAAS,EAAE;AAHN;AAFT,kBAOE,oBAAC,WAAD;AAAa,IAAA,IAAI,EAAEtD;AAAnB,IAPF,EAQGS,EAAE,iBAAI,oBAAC,SAAD;AAAW,IAAA,EAAE,EAAEA;AAAf,IART,eASE,oBAAC,WAAD,QAAcJ,KAAd,CATF,CADF,CADF,eAeE,oBAAC,GAAD,QACGF,SAAS,iBACR,oBAAC,MAAD;AAAQ,IAAA,EAAE,EAAE;AAAZ,kBACE,oBAAC,KAAD;AAAO,IAAA,GAAG,EAAC,OAAX;AAAmB,IAAA,GAAG,EAAEA;AAAxB,IADF,CAFJ,eAOE,oBAAC,MAAD;AAAQ,IAAA,EAAE,EAAEA,SAAS,GAAG,CAAH,GAAO,CAACO,IAAD,GAAQ,EAAR,GAAa;AAAzC,KACGJ,OAAO,iBACN,oBAAC,cAAD;AAAgB,IAAA,OAAO,EAAEA,OAAzB;AAAkC,IAAA,SAAS,MAA3C;AAA4C,IAAA,OAAO,EAAE;AAArD,IAFJ,eAIE,oBAAC,aAAD,QACGK,KAAK,iBACJ,oBAAC,YAAD,qBACE,oBAAC,oBAAD;AAAsB,IAAA,GAAG,EAAEA,KAA3B;AAAkC,IAAA,SAAS;AAA3C,IADF,CAFJ,EAOGb,OAAO,iBACN,oBAAC,eAAD;AACE,IAAA,OAAO,EAAE,CACPP,WADO,EAEP5B,aAFO,EAGPG,aAHO,EAIPsB,aAJO,CADX;AAOE,IAAA,QAAQ,EAAE,kBAACmE,CAAD;AAAA,aAAOvC,cAAc,CAACuC,CAAD,CAArB;AAAA,KAPZ;AAQE,IAAA,WAAW,EAAExC,WARf;AASE,IAAA,QAAQ;AATV,IARJ,CAJF,CAPF,EAkCG,CAACL,IAAD,iBACC,oBAAC,MAAD;AAAQ,IAAA,EAAE,EAAE;AAAZ,kBACE,oBAAC,IAAD;AACE,IAAA,KAAK,EAAEH,UAAU,KAAK,WAAf,GAA6B,OAA7B,GAAuC,MADhD;AAEE,IAAA,IAAI,EAAC;AAFP,IADF,CAnCJ,CAfF,EA2DGG,IAAI,KAAK,IAAT,IAAiBZ,OAAjB,iBACC,oBAAC,iBAAD;AAAmB,IAAA,OAAO,EAAEwB;AAA5B,KACGL,kBAAkB,GAAG,cAAH,GAAoB,iBADzC,EAEGE,kBAAkB,iBAAI,oBAAC,cAAD,OAFzB,CA5DJ,EAkEG1B,WAAW,IAAIA,WAAW,CAAC0D,MAAZ,GAAqB,CAApC,iBACC,oBAAC,oBAAD,QACGK,KAAK,CAAC5D,IAAN,CAAWH,WAAX,EAAwBgE,OAAxB,CAAgC,UAACxB,IAAD,EAAOa,KAAP,EAAiB;AAChD,QAAIA,KAAK,GAAG,CAAZ,EAAe;AACb,0BACE,oBAAC,gBAAD;AACE,QAAA,GAAG,EAAEA,KADP;AAEE,QAAA,OAAO,EAAE;AAAA,iBAAMF,eAAe,CAACnD,WAAD,EAAcqD,KAAd,CAArB;AAAA;AAFX,SAGGrD,WAAW,CAAC0D,MAAZ,GAAqB,CAArB,IAA0BL,KAAK,KAAK,CAApC,iBACC,oBAAC,4BAAD,aACIrD,WAAW,CAAC0D,MAAZ,GAAqB,CADzB,CAJJ,eASE,oBAAC,OAAD;AACE,QAAA,GAAG,EAAE1D,WAAW,CAAC0D,MAAZ,GAAqB,CAArB,IAA0BL,KAAK,KAAK,CAD3C;AAEE,QAAA,WAAW,EAAE;AACXY,UAAAA,SAAS,EAAE,OADA;AAEXC,UAAAA,MAAM,EAAE,OAFG;AAGXC,UAAAA,SAAS,EAAE;AAHA,SAFf;AAOE,QAAA,IAAI,EAAE3B,IAPR;AAQE,QAAA,OAAO;AART,QATF,CADF;AAsBD;AACF,GAzBA,CADH,CAnEJ,CAxBF,CADF;AA4HD,CA9PM;AAAMzC,W;AAgQb,IAAMqE,4BAA4B,GAAG3E,MAAM,CAAC4E,GAAV,uPAAlC;AAYA,IAAMC,cAAc,GAAG7E,MAAM,CAAC4E,GAAV,4HAGhB;AAAA,MAAGpD,IAAH,SAAGA,IAAH;AAAA,SACAA,IAAI,KAAK,KAAT,IACAvB,GADA,iHADA;AAAA,CAHgB,CAApB;AAUA,IAAM6E,iBAAiB,GAAG9E,MAAM,CAAC4E,GAAV,4NAEZ;AAAA,MAAYG,SAAZ,SAAGC,KAAH,CAAYD,SAAZ;AAAA,SAA8BA,SAAS,CAACE,oBAAxC;AAAA,CAFY,CAAvB;AAUA,IAAMC,WAAW,GAAGlF,MAAM,CAAC4E,GAAV,mOAAjB;AAUA,IAAMO,gBAAgB,GAAGnF,MAAM,CAAC4E,GAAV,oJAAtB;AAMA,IAAMQ,oBAAoB,GAAGpF,MAAM,CAAC4E,GAAV,6KAA1B;AAOA,IAAMS,cAAc,GAAGrF,MAAM,CAAC4E,GAAV,gJAIhB;AAAA,MAAGpD,IAAH,SAAGA,IAAH;AAAA,SACAA,IAAI,KAAK,KAAT,IACAvB,GADA,sGADA;AAAA,CAJgB,EAShB;AAAA,MAAGY,OAAH,SAAGA,OAAH;AAAA,SACAA,OAAO,IACPZ,GADO,8JAEHiF,WAFG,CADP;AAAA,CATgB,CAApB;AAmBA,IAAMI,UAAU,GAAGtF,MAAM,CAAC1B,IAAD,CAAT,mNACM;AAAA,MAAGkD,IAAH,SAAGA,IAAH;AAAA,MAAkBuD,SAAlB,SAASC,KAAT,CAAkBD,SAAlB;AAAA,SAClBvD,IAAI,KAAK,IAAT,GACIuD,SAAS,CAACQ,yBADd,GAEIR,SAAS,CAACS,qBAHI;AAAA,CADN,EAMV;AAAA,MAAYT,SAAZ,SAAGC,KAAH,CAAYD,SAAZ;AAAA,SAA8BA,SAAS,CAACU,mBAAxC;AAAA,CANU,EAOG;AAAA,MAAGjE,IAAH,SAAGA,IAAH;AAAA,SACfA,IAAI,KAAK,KAAT,GAAiB,kBAAjB,GAAsC,kBADvB;AAAA,CAPH,CAAhB;AAaA,IAAMkE,aAAa,GAAG1F,MAAM,CAAC4E,GAAV,gHACR;AAAA,MAAYG,SAAZ,UAAGC,KAAH,CAAYD,SAAZ;AAAA,SAA8BA,SAAS,CAACY,oBAAxC;AAAA,CADQ,EAEJ;AAAA,MAAYZ,SAAZ,UAAGC,KAAH,CAAYD,SAAZ;AAAA,SAA8BA,SAAS,CAACa,eAAxC;AAAA,CAFI,CAAnB;AAKA,IAAMC,WAAW,GAAG7F,MAAM,CAAC4E,GAAV,mHACN;AAAA,MAAYG,SAAZ,UAAGC,KAAH,CAAYD,SAAZ;AAAA,SAA8BA,SAAS,CAACe,sBAAxC;AAAA,CADM,CAAjB;AAKA,IAAMC,UAAU,GAAG/F,MAAM,CAACgG,IAAV,2RAEL;AAAA,MAAYjB,SAAZ,UAAGC,KAAH,CAAYD,SAAZ;AAAA,SAA8BA,SAAS,CAACkB,cAAxC;AAAA,CAFK,EAUZ;AAAA,MAAGzE,IAAH,UAAGA,IAAH;AAAA,SACAA,IAAI,KAAK,KAAT,GACIvB,GADJ,gLAMIA,GANJ,oIADA;AAAA,CAVY,CAAhB;AAuBA,IAAMiG,GAAG,GAAGlG,MAAM,CAAC4E,GAAV,0LACa;AAAA,MAAYG,SAAZ,UAAGC,KAAH,CAAYD,SAAZ;AAAA,SAA8BA,SAAS,CAACkB,cAAxC;AAAA,CADb,CAAT;AAQA3F,WAAW,CAAC6F,SAAZ,GAAwB;AACtB1F,EAAAA,OAAO,EAAEvC,GADa;AAEtB+C,EAAAA,SAAS,EAAE9C,MAFW;AAGtBkD,EAAAA,UAAU,EAAElD,MAHU;AAItBmD,EAAAA,IAAI,EAAEnD,MAJgB;AAKtBqD,EAAAA,IAAI,EAAErD;AALgB,CAAxB","sourcesContent":["/**\n * Messaging/Base\n */\n\n// React\nimport React, { useRef, useState } from 'react'\nimport { any, string } from 'prop-types'\n\n// UI\nimport {\n  Avatar,\n  AudioWrapper,\n  Card,\n  Column,\n  Dropdown,\n  hashtagPlugin,\n  Icon,\n  Image,\n  linkifyPlugin,\n  MentionComponent,\n  MessageNames,\n  MessagingActions,\n  MessagingAudioPlayer,\n  MessagingCommunicationService,\n  MessagingEditor,\n  Preview,\n  ReplyContainer,\n  Row,\n  TranslationService\n} from '../../../../../'\n\nimport { MessageIcon } from './icon'\nimport { MessageTo } from './to'\nimport { MenuIcon } from './menuIcon'\nimport { Loadingspinner } from './loadingSpinner'\nimport { EditorState, ContentState, convertFromRaw } from 'draft-js'\nimport createMentionPlugin from '@draft-js-plugins/mention'\nimport createEmojiPlugin from '@draft-js-plugins/emoji'\n\n// Style\nimport styled, { css } from 'styled-components'\n\nconst mentionPlugin = createMentionPlugin({\n  mentionComponent: (mentionProps) => (\n    <MentionComponent mentionProps={mentionProps} />\n  )\n})\n\nconst emojiPlugin = createEmojiPlugin()\n\nexport const MessageBase = ({\n  attachments,\n  avatar,\n  content,\n  from,\n  hasMenu,\n  hasText,\n  hovered,\n  icon,\n  id,\n  more,\n  pictureId,\n  prevType,\n  reply,\n  replyTo,\n  statusText,\n  time,\n  to,\n  type,\n  voice\n}) => {\n  const [editorState, setEditorState] = useState(\n    EditorState.createWithContent(\n      content.blocks\n        ? convertFromRaw(content)\n        : ContentState.createFromText(content)\n    )\n  )\n\n  const [showingTranslation, setShowingTranslation] = useState(false)\n  const [loadingTranslation, setloadingTranslation] = useState(false)\n  const translated = useRef(null)\n\n  const toggleTranslation = async () => {\n    if (!showingTranslation) {\n      if (!translated.current) {\n        setloadingTranslation(true)\n        let plainText\n        if (content.blocks) {\n          plainText = content.blocks\n            .map((block) => (!block.text.trim() && '\\n') || block.text)\n            .join('\\n')\n        } else {\n          plainText = content\n        }\n        const { response } = await TranslationService.Translate(plainText)\n        translated.current = EditorState.createWithContent(\n          ContentState.createFromText(response)\n        )\n        setEditorState(translated.current)\n        setShowingTranslation(true)\n        setloadingTranslation(false)\n      } else {\n        setEditorState(translated.current)\n        setShowingTranslation(true)\n      }\n    } else {\n      setEditorState(\n        EditorState.createWithContent(\n          content.blocks\n            ? convertFromRaw(content)\n            : ContentState.createFromText(content)\n        )\n      )\n      setShowingTranslation(false)\n    }\n  }\n  const dropDownAction = (item) => {\n    let action = ''\n    switch (item.id) {\n      case 'edit':\n        action = MessagingActions.EDIT_MESSAGE\n        break\n      case 'delete':\n        action = MessagingActions.DELETE_MESSAGE\n        break\n      case 'star':\n        action = MessagingActions.STAR_MESSAGE\n        break\n\n      default:\n        break\n    }\n    MessagingCommunicationService.send({\n      name: MessageNames.Messaging.MESSAGING_ACTION,\n      payload: {\n        action,\n        data: {\n          attachments,\n          content,\n          from,\n          hovered,\n          icon,\n          id,\n          more,\n          pictureId,\n          prevType,\n          reply,\n          statusText,\n          time,\n          to,\n          type,\n          voice\n        }\n      }\n    })\n  }\n\n  const handleFileClick = (files, index) => {\n    const av = avatar ? (\n      <Avatar size=\"xxs\" src={avatar} />\n    ) : (\n      <Avatar size=\"xxs\" content={from[0]} />\n    )\n\n    MessagingCommunicationService.send({\n      name: MessageNames.Messaging.MESSAGING_ACTION,\n      payload: {\n        action: MessagingActions.SET_FULL_PREVIEW_FILES,\n        data: {\n          files,\n          selectedIndex: index,\n          avatar: av,\n          from,\n          time\n        }\n      }\n    })\n  }\n\n  return (\n    <MessageWrapper type={type} hovered={hovered}>\n      <StyledHead type={type}>\n        <StyledHeadText type={type}>\n          {from} <Dot />\n          {time.split(' ')[time.split(' ').length - 1]}\n        </StyledHeadText>\n\n        {hasMenu && (\n          <MenuWrapper>\n            <Dropdown\n              caret={false}\n              items={[\n                { name: 'Star Message', id: 'star' },\n                { name: 'Edit Message', id: 'edit' },\n                { name: 'Delete Message', id: 'delete' }\n              ]}\n              position=\"bottom\"\n              onChange={(item) => dropDownAction(item)}>\n              <MenuIcon />\n            </Dropdown>\n          </MenuWrapper>\n        )}\n      </StyledHead>\n\n      <StyledCard type={type}>\n        <Row>\n          <Column\n            sm={6}\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              marginTop: '-0.5rem'\n            }}>\n            <MessageIcon icon={icon} />\n            {to && <MessageTo to={to} />}\n            <StyledReply>{reply}</StyledReply>\n          </Column>\n        </Row>\n\n        <Row>\n          {pictureId && (\n            <Column sm={2}>\n              <Image alt=\"Image\" src={pictureId} />\n            </Column>\n          )}\n\n          <Column sm={pictureId ? 8 : !type ? 11 : 12}>\n            {replyTo && (\n              <ReplyContainer message={replyTo} inMessage onClose={null} />\n            )}\n            <StyledContent>\n              {voice && (\n                <AudioWrapper>\n                  <MessagingAudioPlayer src={voice} inMessage />\n                </AudioWrapper>\n              )}\n\n              {hasText && (\n                <MessagingEditor\n                  plugins={[\n                    emojiPlugin,\n                    hashtagPlugin,\n                    linkifyPlugin,\n                    mentionPlugin\n                  ]}\n                  onChange={(e) => setEditorState(e)}\n                  editorState={editorState}\n                  readOnly\n                />\n              )}\n            </StyledContent>\n          </Column>\n\n          {!type && (\n            <Column sm={1}>\n              <Icon\n                color={statusText === 'Delivered' ? 'green' : '#bbb'}\n                icon=\"check-circle\"\n              />\n            </Column>\n          )}\n        </Row>\n\n        {type === 'in' && hasText && (\n          <TranslatorWrapper onClick={toggleTranslation}>\n            {showingTranslation ? 'See Original' : 'See Translation'}\n            {loadingTranslation && <Loadingspinner />}\n          </TranslatorWrapper>\n        )}\n\n        {attachments && attachments.length > 0 && (\n          <AttachmentsContainer>\n            {Array.from(attachments).forEach((item, index) => {\n              if (index < 4) {\n                return (\n                  <SingleAttachment\n                    key={index}\n                    onClick={() => handleFileClick(attachments, index)}>\n                    {attachments.length > 4 && index === 3 && (\n                      <OverlayForAdditionalMessages>\n                        +{attachments.length - 4}\n                      </OverlayForAdditionalMessages>\n                    )}\n\n                    <Preview\n                      dim={attachments.length > 4 && index === 3}\n                      imageStyles={{\n                        minHeight: '10rem',\n                        height: '10rem',\n                        objectFit: 'cover'\n                      }}\n                      file={item}\n                      message\n                    />\n                  </SingleAttachment>\n                )\n              }\n            })}\n          </AttachmentsContainer>\n        )}\n      </StyledCard>\n    </MessageWrapper>\n  )\n}\n\nconst OverlayForAdditionalMessages = styled.div`\n  align-items: center;\n  color: white;\n  display: flex;\n  height: 40%;\n  font-size: 5rem;\n  position: absolute;\n  justify-content: center;\n  width: 40%;\n  z-index: 1;\n`\n\nconst StyledHeadText = styled.div`\n  display: flex;\n  align-items: center;\n  ${({ type }) =>\n    type === 'out' &&\n    css`\n      flex-direction: row-reverse;\n    `}\n`\n\nconst TranslatorWrapper = styled.div`\n  align-items: center;\n  color: ${({ theme: { MESSAGING } }) => MESSAGING.translatorTextColour};\n  cursor: pointer;\n  display: flex;\n  font-size: 0.625rem;\n  font-weight: 600;\n  width: fit-content;\n`\n\nconst MenuWrapper = styled.div`\n  cursor: pointer;\n  display: flex;\n  margin-top: -1rem;\n  margin-bottom: -1rem;\n  opacity: 0;\n  pointer-events: none;\n  transition: opacity 0.3s;\n`\n\nconst SingleAttachment = styled.div`\n  cursor: pointer;\n  overflow: hidden;\n  max-width: calc(90% - 0.5rem);\n`\n\nconst AttachmentsContainer = styled.div`\n  display: grid;\n  grid-template-columns: 49% 49%;\n  grid-row: auto auto;\n  grid-row-gap: 1rem;\n`\n\nconst MessageWrapper = styled.div`\n  flex: 1;\n  margin-top: 1.5rem;\n  max-width: 80%;\n  ${({ type }) =>\n    type === 'out' &&\n    css`\n      margin-left: 20%;\n    `}\n  ${({ hovered }) =>\n    hovered &&\n    css`\n      ${MenuWrapper} {\n        opacity: 1;\n        pointer-events: inherit;\n      }\n    `}\n`\n\nconst StyledCard = styled(Card)`\n  background-color: ${({ type, theme: { MESSAGING } }) =>\n    type === 'in'\n      ? MESSAGING.receivedMessageBackground\n      : MESSAGING.sentMessageBackground};\n  border: 1px solid\n    ${({ theme: { MESSAGING } }) => MESSAGING.messageBorderColour};\n  border-radius: ${({ type }) =>\n    type === 'out' ? '1rem 0 1rem 1rem' : '0 1rem 1rem 1rem'};\n  margin-bottom: 0.5rem;\n  padding: 1.25rem 1rem;\n`\n\nconst StyledContent = styled.div`\n  color: ${({ theme: { MESSAGING } }) => MESSAGING.messageContentColour};\n  font-size: ${({ theme: { MESSAGING } }) => MESSAGING.messageFontSize};\n`\n\nconst StyledReply = styled.div`\n  color: ${({ theme: { MESSAGING } }) => MESSAGING.messageReplyTextColour};\n  font-size: 0.75rem;\n`\n\nconst StyledHead = styled.span`\n  align-items: center;\n  color: ${({ theme: { MESSAGING } }) => MESSAGING.fromTextColour};\n  display: flex;\n  font-size: 0.75rem;\n  font-weight: 600;\n  justify-content: space-between;\n  position: absolute;\n  text-align: right;\n  top: 0.25rem;\n  ${({ type }) =>\n    type === 'out'\n      ? css`\n          flex-direction: row-reverse;\n          right: 3.25rem;\n          width: 73%;\n        `\n      : css`\n          left: 3.25rem;\n          width: 80%;\n        `}\n`\n\nconst Dot = styled.div`\n  background-color: ${({ theme: { MESSAGING } }) => MESSAGING.fromTextColour};\n  border-radius: 1rem;\n  height: 0.25rem;\n  margin: 0.25rem;\n  width: 0.25rem;\n`\n\nMessageBase.propTypes = {\n  content: any,\n  pictureId: string,\n  statusText: string,\n  time: string,\n  type: string\n}\n"],"file":"base.js"}