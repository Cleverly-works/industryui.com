{"version":3,"sources":["../../../../../components/organisms/messaging/components/send/index.js"],"names":["React","useRef","useState","array","func","number","convertToRaw","AudioWrapper","Button","Dropdown","EmojiSelect","EmojiSuggestions","Icon","VoiceRecorder","MessagingInput","MessagingAudioPlayer","MessageNames","MessagingActions","MessagingCommunicationService","MessagingSubscriber","PaperPlaneIcon","ReplyContainer","useComponentCommunication","styled","MessagingSend","audienceItems","maxLength","mentions","onSubmit","Message","setMessage","attachments","setAttachments","voiceMessage","setVoiceMessage","audience","setAudience","fileInputRef","openFileDialog","current","click","handleFilesChange","e","files","target","send","name","Messaging","MESSAGING_ACTION","payload","action","SET_ATTACHMENTS_TO_NEW_MESSAGE","data","replyMessage","setreplyMessage","onActionRecieved","REPLY_MESSAGE","messageName","onRecieve","subscriber","submit","replyTo","id","message","voice","handleInputChange","contentState","getCurrentContent","isSendDisabled","disabled","length","blocks","text","handleDeleteVoiceClick","handleVoiceRecord","item","URL","createObjectURL","display","DeleteIconWrapper","div","EmojiSelectWrapper","MESSAGING","theme","inputIconsColour","inpotIconsHoverColour","StyledElements","StyledContainer","inputSectionBackground","StyledDropDown","COLOUR","info","StyledWrapper","StyledIcon","propTypes","isRequired","defaultProps"],"mappings":"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","sourcesContent":["/**\n * Messaging/Send\n */\n\n// React\nimport React, { useRef, useState } from 'react'\nimport { array, func, number } from 'prop-types'\n\n// DraftJS\nimport { convertToRaw } from 'draft-js'\n\n// UI\nimport {\n  AudioWrapper,\n  Button,\n  Dropdown,\n  EmojiSelect,\n  EmojiSuggestions,\n  Icon,\n  VoiceRecorder,\n  MessagingInput,\n  MessagingAudioPlayer,\n  MessageNames,\n  MessagingActions,\n  MessagingCommunicationService,\n  MessagingSubscriber,\n  PaperPlaneIcon,\n  ReplyContainer,\n  useComponentCommunication\n} from '../../../../'\n\n// Style\nimport styled from 'styled-components'\n\nexport const MessagingSend = ({\n  audienceItems,\n  maxLength,\n  mentions,\n  onSubmit\n}) => {\n  // const [open, setOpen] = useState(false)\n  const [Message, setMessage] = useState({})\n  const [attachments, setAttachments] = useState([])\n  const [voiceMessage, setVoiceMessage] = useState(null)\n  const [audience, setAudience] = useState(audienceItems[0] || '')\n  const fileInputRef = useRef()\n\n  const openFileDialog = () => {\n    fileInputRef.current.click()\n  }\n\n  const handleFilesChange = (e) => {\n    const { files } = e.target\n    MessagingCommunicationService.send({\n      name: MessageNames.Messaging.MESSAGING_ACTION,\n      payload: {\n        action: MessagingActions.SET_ATTACHMENTS_TO_NEW_MESSAGE,\n        data: files\n      }\n    })\n  }\n\n  const [replyMessage, setreplyMessage] = useState(null)\n\n  const onActionRecieved = (payload) => {\n    switch (payload.action) {\n      case MessagingActions.SET_ATTACHMENTS_TO_NEW_MESSAGE:\n        setAttachments(payload.data)\n        break\n      case MessagingActions.REPLY_MESSAGE:\n        setreplyMessage(payload.data)\n        break\n\n      default:\n        break\n    }\n  }\n\n  useComponentCommunication({\n    messageName: MessageNames.Messaging.MESSAGING_ACTION,\n    onRecieve: (e) => onActionRecieved(e),\n    subscriber: MessagingSubscriber\n  })\n\n  const submit = () => {\n    replyMessage?.replyTo && delete replyMessage.replyTo\n    const data = {\n      attachments,\n      audience: audience.id,\n      message: Message,\n      ...(voiceMessage && { voice: voiceMessage }),\n      ...(replyMessage && { replyTo: replyMessage })\n    }\n\n    onSubmit(data)\n    setVoiceMessage(null)\n    setreplyMessage(null)\n  }\n\n  const handleInputChange = (e) => {\n    const contentState = e.getCurrentContent()\n    setMessage(convertToRaw(contentState))\n  }\n  const isSendDisabled = () => {\n    let disabled = false\n    if (\n      attachments.length === 0 &&\n      (Message === {} ||\n        (Message.blocks && !Message.blocks[0].text && voiceMessage === null))\n    ) {\n      disabled = true\n    }\n    return disabled\n  }\n  const handleDeleteVoiceClick = () => {\n    setVoiceMessage(null)\n  }\n\n  const handleVoiceRecord = (e) => {\n    setVoiceMessage(e.data)\n  }\n\n  return (\n    <>\n      <StyledContainer audience={audience}>\n        {replyMessage && (\n          <ReplyContainer\n            message={replyMessage}\n            onClose={() => setreplyMessage(null)}>\n            {replyMessage.id}\n          </ReplyContainer>\n        )}\n\n        <StyledWrapper>\n          {audience && (\n            <StyledDropDown\n              items={audienceItems}\n              onChange={(item) => setAudience(item)}\n              position=\"top\">\n              {audience.name}\n            </StyledDropDown>\n          )}\n          <StyledElements>\n            <EmojiSelectWrapper>\n              <EmojiSuggestions />\n              <EmojiSelect />\n            </EmojiSelectWrapper>\n            <StyledIcon\n              fixedWidth={false}\n              icon=\"paperclip\"\n              onClick={openFileDialog}\n              size=\"lg\"\n            />\n          </StyledElements>\n\n          {voiceMessage && (\n            <AudioWrapper preview>\n              <MessagingAudioPlayer src={URL.createObjectURL(voiceMessage)} />\n              <DeleteIconWrapper onClick={handleDeleteVoiceClick}>\n                <Icon context=\"danger\" icon=\"trash\" prefix=\"fas\" size=\"lg\" />\n              </DeleteIconWrapper>\n            </AudioWrapper>\n          )}\n\n          <MessagingInput mentions={mentions} onChange={handleInputChange} />\n\n          <input\n            multiple\n            onChange={handleFilesChange}\n            ref={fileInputRef}\n            style={{ display: 'none' }}\n            type=\"file\"\n          />\n          <StyledElements>\n            {isSendDisabled() ? (\n              <VoiceRecorder onVoiceRecord={handleVoiceRecord} />\n            ) : (\n              <Button\n                context=\"transparent\"\n                disabled={isSendDisabled()}\n                noPadding\n                onClick={submit}\n                size=\"xs\">\n                <PaperPlaneIcon hoverColour />\n              </Button>\n            )}\n          </StyledElements>\n        </StyledWrapper>\n      </StyledContainer>\n    </>\n  )\n}\n\nconst DeleteIconWrapper = styled.div`\n  padding-top: 1rem;\n  padding-top: 0.5rem;\n  cursor: pointer;\n`\n\nconst EmojiSelectWrapper = styled.div`\n  [class*='emojiSelectPopover_'] {\n    top: -400px;\n    left: -10px;\n  }\n  [class*='emojiSuggestions'] {\n    top: -350px !important;\n  }\n  [class*='draftJsEmojiPlugin__emojiSelectButton_'] {\n    background-color: transparent !important;\n    border: none;\n    color: ${({ theme: { MESSAGING } }) => MESSAGING.inputIconsColour};\n    font-size: 2.5rem;\n    font-weight: 600;\n    height: unset;\n    margin-top: -5px;\n    margin-right: 3px;\n    &:hover {\n      color: ${({ theme: { MESSAGING } }) => MESSAGING.inpotIconsHoverColour};\n    }\n    width: unset;\n  }\n`\nconst StyledElements = styled.div`\n  align-items: center;\n  display: flex;\n  place-content: space-evenly;\n  width: 4rem;\n`\n\nconst StyledContainer = styled.div`\n  background-color: ${({ theme: { MESSAGING } }) =>\n    MESSAGING.inputSectionBackground};\n  border-bottom: 1px solid #c0c0c0;\n  border-top: 1px solid #c0c0c0;\n  box-sizing: border-box;\n  color: #c0c0c0;\n  padding: ${({ audience }) => (audience ? '1.5rem 1rem 1rem' : '1rem')};\n  position: relative;\n  .public-DraftStyleDefault-block {\n    margin: 0.5em 0;\n  }\n`\n\nconst StyledDropDown = styled(Dropdown)`\n  position: absolute;\n  left: 8px;\n  text-transform: uppercase;\n  top: -24px;\n\n  .dropdown--link {\n    color: #000;\n    font-size: 10px;\n  }\n\n  .dropdown--toggle,\n  svg {\n    color: ${({ theme }) => theme.COLOUR.info};\n    font-size: 10px;\n  }\n`\nconst StyledWrapper = styled.div`\n  display: flex;\n  position: relative;\n  margin: 0;\n`\n\nconst StyledIcon = styled(Icon)`\n  cursor: pointer;\n  margin-right: 1rem;\n  color: ${({ theme: { MESSAGING } }) => MESSAGING.inputIconsColour};\n  &:hover {\n    color: ${({ theme: { MESSAGING } }) => MESSAGING.inpotIconsHoverColour};\n  }\n`\n\nMessagingSend.propTypes = {\n  audienceItems: array,\n  onSubmit: func.isRequired,\n  maxLength: number\n}\n\nMessagingSend.defaultProps = {\n  audienceItems: [],\n  maxLength: 320\n}\n"],"file":"index.js"}